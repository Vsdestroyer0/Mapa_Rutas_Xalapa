---
import type { GetStaticPaths } from "astro";
import MainLayout from "../../layouts/mainLayout.astro";
import Map from "../../components/Map.jsx";
import BusView from "../../components/BusView.astro";
import RouteStats from "../../components/RouteStats.jsx";

import rutas from "../../data/rutas.json";

// 2️ genera las páginas estáticas
export const getStaticPaths = (() => {
  return rutas.map((r: any) => ({
    params: { id: r.id.toString() },
    props: { route: r },
  }));
}) satisfies GetStaticPaths;

const { route } = Astro.props;
---

<MainLayout title={`Ruta ${route.label}`}>
  <section class="space-y-6">
    <!-- Nombre de la ruta -->
    <h1 class="text-3xl font-bold text-gray-800">{route.label}</h1>

    <!-- Imagen del autobús (si existe) -->
    {
      route.images && route.images.length > 0 && (
        <BusView src={route.images[0]} />
      )
    }

    <!-- Stats dinámicos -->
    <RouteStats route={route.stops} client:load />

    <!-- Mapa interactivo -->
    <div class="h-[500px] w-full rounded-lg overflow-hidden shadow-md">
      <Map
        client:only="react"
        stops={route.stops || []}
        points={route.points || []}
        color={route.color}
        isCircuit={route.type === "circuit"}
      />
    </div>
  </section>
</MainLayout>
