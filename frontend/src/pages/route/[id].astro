---
export const prerender = false; // SSR en vez de SSG

import MainLayout from "../../layouts/mainLayout.astro";
import Map from "../../components/Map.jsx";
import BusView from "../../components/BusView.astro";
import RouteStats from "../../components/RouteStats.jsx";

interface Ruta {
  _id: string;
  id: number;
  label: string;
  type?: string;
  color?: string;
  points?: [number, number][];
  stops?: any[];
  images?: string[];
}

//  id de la URL
const { id } = Astro.params;

const res = await fetch(`http://localhost:3000/api/rutas/${id}`);
console.log(res);
if (!res.ok) throw new Error("Ruta no encontrada");
const route = (await res.json()) as Ruta;
---

<MainLayout title={`Ruta ${route.label}`}>
  <section class="space-y-6">
    <h1 class="text-3xl font-bold text-gray-800">{route.label}</h1>

    {route.images?.[0] && <BusView src={route.images[0]} />}
    <RouteStats route={route.stops} client:load />

    <div class="h-[500px] w-full rounded-lg overflow-hidden shadow-md">
      <Map
        client:only="react"
        stops={route.stops || []}
        points={route.points || []}
        color={route.color}
        isCircuit={route.type === "circuit"}
      />
    </div>
  </section>
</MainLayout>
